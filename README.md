# Project Second (Scripts)
## 仓库说明
本仓库（至少计划上）为存放剧本源代码以及剧本转换为（部分）可执行KAG代码的工程的仓库。
## 仓库特性以及完成情况
- 将源代码转换成某种json格式（完成）
- 基于表情信息粗略标注每一句台词情感（完成）
- 维护剧本中CG、背景、立绘、音效从剧本到实际静态资产的映射（几乎完成）
- 将json格式转化为KAG脚本格式（未完成）
## 使用说明
首先，你需要安装一个Python。测试使用的Python版本为3.11.4, 但理论上大部分Python3都能够运行这一脚本。

其次，你需要安装相关依赖。本工程尽可能少的依赖于其他库，因此在不使用GUI的前提下你可以不安装任何额外的包。
如果你想要使用GUI（开发中，现在还用不了），请运行下列指令：
```ps
python -m pip install textual --user
```
以启用GUI功能。

再之后，你需要下载工程中的静态资源。打开文档里的北航云盘链接，将整个`美术资源`文件夹下载为压缩包，再直接解压到工程目录下的`assets`文件夹中。
相信本工程的用户不会问出如何解压压缩文件之类的问题（

最后，运行脚本来将剧本（尽可能地）转化为KAG代码以及其他泛用格式（考虑到用户群体，注意以下路径为Windows格式）。

### GUI
首先打开任意一个终端。如果你不知道如何开启终端，你可以在资源管理器中打开工程文件夹（就是你解压出来的那个），
按住`Shift`键并右击工程文件夹中**任意一个空白位置**，并在弹出来的菜单中选择`在此处打开Powershell窗口`。
如果操作得当，应该会有一个蓝色窗口出现，你可以向窗口中敲键盘来运行程序。
在终端中输入
```ps
python .\src\guimake.py
```
并敲回车来尝试编译任意一个现有剧本。请遵照终端中给出的指示进行操作。

如果运行得当，应该能看到如下的一个界面：

![](https://p.inari.site/guest/25-06/13/684c4857dcc42.png)

请根据指示进行进一步操作。

（UI确实有点丑，但是我不想写前端了）
### CLI
运行
```ps
python .\src\make.py demo
```
来尝试编译demo剧本。如果程序向你询问任意输入，敲回车来略过。在现在版本的脚本下，你将能在output文件夹下看到以下输出文件：
```
output\
    |---demo\
    |   |---demo.txt 适合人类阅读的剧本格式。纯文本。
    |   |---demo_with_expressions.txt 包含表情指令的，适合人类阅读的剧本格式。已经不被维护。
    |   |---demo_ast.json 适合机器阅读的剧本格式，具体格式类似与群文档中的剧本格式。建议使用。
    |---bg.json 剧本中找不到映射的背景。
    |---cg.json 剧本中找不到映射的CG。
    |---fg.json 剧本中找不到映射的立绘。
    |---se.json 剧本中找不到映射的音效。
```
通过在工程目录下`src\maps\ir.json`中添加映射，可以解决上述找不到映射的问题。
